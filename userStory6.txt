//email service 

package com.scb.creditcardorigination.userStory6.service;
import com.scb.creditcardorigination.userStory6.model.EmailLog;
import com.scb.creditcardorigination.userStory6.repository.EmailLogRepository;
import org.springframework.stereotype.Service;
import java.time.LocalDateTime;
@Service
public class EmailService {
    private final EmailLogRepository emailLogRepository;
    public EmailService(EmailLogRepository emailLogRepository) {
        this.emailLogRepository = emailLogRepository;
    }
    public void sendConfirmation(String emailId, String cardNumber) {
        // Save email log entry
        EmailLog emailLog = new EmailLog();
        emailLog.setEmailId(emailId);
        emailLog.setCardNumber(cardNumber);
        // Add subject + body
        String subject = "Credit Card Creation Confirmation";
        String body = "Dear Customer,\n\nYour credit card with number " + cardNumber +
                " has been created successfully.\n\nThank you for choosing our services.\n\nRegards,\nSCB Team";

        emailLog.setMessage("Subject: " + subject + "\n\nBody:\n" + body);
        emailLog.setSentAt(LocalDateTime.now());
        emailLogRepository.save(emailLog);
        // Print formatted email in console
        System.out.println("===== EMAIL SENT =====");
        System.out.println("To : " + emailId);
        System.out.println("Card Number: " + cardNumber);
        System.out.println("Subject: " + subject);
        System.out.println("Body:\n" + body);
    }

}
//Email request 
package com.scb.creditcardorigination.userStory6.dto;

public class EmailRequest {
    private String emailId;
    private String cardNumber;

    public EmailRequest() {
    }

    public String getEmailId() {
        return emailId;
    }

    public void setEmailId(String emailId) {
        this.emailId = emailId;
    }

    public String getCardNumber() {
        return cardNumber;
    }

    public void setCardNumber(String cardNumber) {
        this.cardNumber = cardNumber;
    }
}

//email log controller 
package com.scb.creditcardorigination.userStory6.controller;
import com.scb.creditcardorigination.userStory6.dto.EmailRequest;
import com.scb.creditcardorigination.userStory6.model.EmailLog;
import com.scb.creditcardorigination.userStory6.repository.EmailLogRepository;
import com.scb.creditcardorigination.userStory6.service.EmailService;
import org.springframework.web.bind.annotation.*;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
@RestController
@RequestMapping("/api/email_logs")
public class EmailLogController {
    private final EmailLogRepository emailLogRepository;
    private final EmailService emailService;
    public EmailLogController(EmailLogRepository emailLogRepository, EmailService emailService) {
        this.emailLogRepository = emailLogRepository;
        this.emailService = emailService;
    }
    // GET all logs
    @GetMapping("/all")
    public List<EmailLog> getAllLogs() {
        return emailLogRepository.findAll();
    }

    @PostMapping("/send")
    public Map<String, String> sendEmail(@RequestBody EmailRequest request) {
        emailService.sendConfirmation(request.getEmailId(), request.getCardNumber());
        Map<String, String> response = new HashMap<>();
        response.put("status", "Email Sent Successfully");
        response.put("EmailId", String.valueOf(request.getEmailId()));
        response.put("cardNumber", request.getCardNumber());
        return response;
    }
}


//email log.java
package com.scb.creditcardorigination.userStory6.model;

import jakarta.persistence.*;

import java.time.LocalDateTime;

@Entity
@Table(name = "email_log")
public class EmailLog {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
   private String emailId;

    private String cardNumber;
    @Column(length = 1000)
    private String message;

    private LocalDateTime sentAt;
    public EmailLog() {}

    public EmailLog(String emailId, String cardNumber, String message, LocalDateTime sentAt) {
        this.emailId = emailId;
        this.cardNumber = cardNumber;
        this.message = message;
        this.sentAt = sentAt;
    }


    public Long getId() {
        return id;
    }

    public String getEmailId() {
        return emailId;
    }

    public void setEmailId(String emailId) {
        this.emailId = emailId;
    }

    public String getCardNumber() {
        return cardNumber;
    }

    public void setCardNumber(String cardNumber) {
        this.cardNumber = cardNumber;
    }

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }

    public LocalDateTime getSentAt() {
        return sentAt;
    }

    public void setSentAt(LocalDateTime sentAt) {
        this.sentAt = sentAt;
    }

    @Override
    public String toString() {
        return "EmailLog{" +
                "id=" + id +
                ", EmailId=" + emailId +
                ", cardNumber='" + cardNumber + '\'' +
                ", message='" + message + '\'' +
                ", sentAt=" + sentAt +
                '}';
    }
}

//schema.sql
CREATE TABLE email_log (
    id SERIAL PRIMARY KEY,
    customer_id INTEGER ,
    card_number VARCHAR(65),
    message TEXT,
    sent_at TIMESTAMP

);


